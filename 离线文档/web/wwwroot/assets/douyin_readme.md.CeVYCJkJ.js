import{_ as s,c as i,o as a,a4 as t}from"./chunks/framework.CI8or701.js";const g=JSON.parse('{"title":"抖音平台SDK","description":"抖音开放平台SDK相关开发资料","frontmatter":{"home":false,"editLink":false,"lang":"zh-CN","title":"抖音平台SDK","description":"抖音开放平台SDK相关开发资料"},"headers":[],"relativePath":"douyin/readme.md","filePath":"douyin/readme.md","lastUpdated":1713227600000}'),p={name:"douyin/readme.md"},n=t(`<h2 id="快速使用" tabindex="-1">快速使用 <a class="header-anchor" href="#快速使用" aria-label="Permalink to &quot;快速使用&quot;">​</a></h2><ol><li>添加抖音服务</li></ol><p>引用 <code>RsCode.Douyin.dll</code></p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">servcies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddDouyin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><ol start="2"><li>添加抖音参数配置</li></ol><p>douyin.json配置</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{  </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;appid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tt6be31d5ef&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;secret&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8ea50e45ac8ea5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4NTe3b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;salt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4NTe3b5bEvzpN834&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;privateKeyPath&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cert/douyin/privatekey.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//应用的私钥</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 	  &quot;publicKeyPath&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cert/douyin/publickey.pem&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //抖音平台的公钥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>项目根目录下，创建cert文件夹，保存公钥与私钥</p><ol start="3"><li>密钥生成</li></ol><h3 id="创建应用公钥" tabindex="-1">创建应用公钥 <a class="header-anchor" href="#创建应用公钥" aria-label="Permalink to &quot;创建应用公钥&quot;">​</a></h3><p>应用公钥和私钥的生成方式可参考：</p><p>更详细的证书制作过程，查看这篇文章 <a href="https://mp.weixin.qq.com/s?__biz=MzI2NTUyNzgwMg==&amp;mid=2247483704&amp;idx=1&amp;sn=b4fc33bfe12dd303fa8475f4f2409169&amp;chksm=ea9d49adddeac0bbe3a8c6dbb970f4b741572244c651b4cf8fc9407d7f70f96d950f002c891e&amp;token=2073611602&amp;lang=zh_CN#rd" target="_blank" rel="noreferrer">Cert证书制作教程</a></p><p>windows下制作证书</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>openssl genrsa -out d:\\privatekey.pem 2048</span></span>
<span class="line"><span>openssl rsa -in d:\\privatekey.pem -pubout -out d:\\publickey.pem</span></span></code></pre></div><h3 id="上传应用公钥" tabindex="-1">上传应用公钥 <a class="header-anchor" href="#上传应用公钥" aria-label="Permalink to &quot;上传应用公钥&quot;">​</a></h3><p>登录「<a href="https://developer.open-douyin.com/" target="_blank" rel="noreferrer">抖音开放平台</a>」，进入小程序的「开发管理-开发设置」页，在「密钥设置」处点击“更新”</p><p><img src="https://sf1-cdn-tos.douyinstatic.com/obj/microapp/frontend/docs/images/1280X1280%20(1)-5212092303134899.PNG" alt="img"></p><p>在cert文件夹中准备两个证书文件 应用私钥privatekey.pem 和平台公钥publickey.pem</p><p>应用私钥privatekey.pem 复制上一步生成的privatekey.pem即可</p><p>平台公钥publickey.pem，到抖音平台-某小程序-开发-开发配置，显示的平台公钥中，复制它，保存到publickey.pem中</p><p>先生成密钥，再测试上线，不用官方提供的参数，有坑</p><p><strong>回调签名算法</strong></p><p>支付回调通知开发者服务端时，会使用如下的算法进行签名，供开发者验证请求的来源：</p><ol><li><p>在抖音开放平台-【某小程序】-【功能】-【支付】-【支付产品】-【支付设置】中获取Token， 按照接口文档将所有请求字段（验证时注意不包含 sign 签名本身，不包含空字段与 type 常量字段）内容与平台上配置的 token 一起，进行字典序排序。</p></li><li><p>所有字段内容连接成一个字符串</p></li><li><p>使用 sha-1 算法计算字符串摘要作为签名</p></li></ol><p>上述步骤计算出的签名 signature，和支付回调请求体里面的 signature 对比，如果不一致，说明请求不可信任(如被篡改)</p><p><a href="https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/open-capacity/guaranteed-payment/TE/#_%E7%AC%AC%E4%BA%94%E6%AD%A5%E5%8A%A0%E7%AD%BE%E9%AA%8C%E7%AD%BE%E5%BC%80%E5%8F%91" target="_blank" rel="noreferrer">抖音支付之加签验签开发</a></p><p>抖音开放平台-【某小程序】-【功能】-【支付】-【支付方式管理】-【支付设置】中查看支付系统秘钥 SALT</p><p>参数的签名：1排除参数app_id, third_party_id,sign,other_settle_params 不参与签名</p><p>2对其它参数的值（如果参数值为null,添加<code>&lt;nil&gt;</code>）和支付设置中的salt一起进行ascii码排序，</p><p>密钥（功能管理-支付-支付设置-SALT）</p><p>请求参数中签名是md5签名</p><p>回调验签字符例子</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;appid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tt6be31d5ef4dfda0b01&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;cp_orderno&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;174430247936&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;cp_extra&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;way&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;10&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;channel_no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TP2023052621135500973701287530&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;channel_gateway_no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;payment_order_no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DPS2305262113589004661092192889&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;out_channel_order_no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TP2023052621135500973701287530&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;total_amount&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SUCCESS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;seller_uid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;72370059863623948910&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;extra&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;item_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;paid_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1685106853</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;order_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;N7237478737451911458&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;ec_pay_trade_no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;DTPP2305262113529021149660512889&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="支付自助校验" tabindex="-1">支付自助校验 <a class="header-anchor" href="#支付自助校验" aria-label="Permalink to &quot;支付自助校验&quot;">​</a></h2><p><a href="https://pay-doc.toutiao.com/tools/sign" target="_blank" rel="noreferrer">支付自动校验</a></p><p>token salt 担保支付中要使用 使用token验签 使用salt签名</p><p>DouyinRequest 中参数名方法 CreateParamSign()</p><p>PayNotifyData中验签方法VerifySign()</p><p>平台公钥没有用到</p>`,39),h=[n];function e(l,k,E,o,r,d){return a(),i("div",null,h)}const y=s(p,[["render",e]]);export{g as __pageData,y as default};
