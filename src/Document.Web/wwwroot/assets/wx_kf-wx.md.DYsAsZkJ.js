import{_ as s,c as i,o as a,a4 as e}from"./chunks/framework.CI8or701.js";const o=JSON.parse('{"title":"客服消息-公众号","description":"公众号客服消息","frontmatter":{"home":false,"editLink":false,"lang":"zh-CN","title":"客服消息-公众号","description":"公众号客服消息"},"headers":[],"relativePath":"wx/kf-wx.md","filePath":"wx/kf-wx.md","lastUpdated":1713227600000}'),n={name:"wx/kf-wx.md"},t=e(`<p><a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Service_Center_messages.html" target="_blank" rel="noreferrer">微信官方文档</a></p><h5 id="客服消息流程" tabindex="-1">客服消息流程： <a class="header-anchor" href="#客服消息流程" aria-label="Permalink to &quot;客服消息流程：&quot;">​</a></h5><p>公众号处于开发模式时<br> 1.用户在公众号内发送消息--&gt;微信服务器接收<br> 2.微信服务器POST消息--&gt;开者者填写的url<br> 3.开发者在响应包中返回MsgType为transfer_customer_service的消息<br> 4.微信服务器收到响应后会把当次发送的消息转发至客服系统</p><p>用例1 公众号转发用户的消息至客服消息</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OnReceiveTextMessageEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TextMessage</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> receiveMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    string</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fromUserName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receiveMessage.FromUserName;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    string</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> toUserName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receiveMessage.ToUserName;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //转发用户消息到客服</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    TransferCustomerServiceMessage</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TransferCustomerServiceMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fromUserName, toUserName);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WeChatOptions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FirstOrDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c.Id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> toUserName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wechat.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UseAppId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options.AppId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wechat.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SendMessageAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TransferCustomerServiceMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,5),h=[t];function k(p,l,r,d,g,E){return a(),i("div",null,h)}const y=s(n,[["render",k]]);export{o as __pageData,y as default};
