import{_ as s,c as a,o as i,a4 as t}from"./chunks/framework.CI8or701.js";const n="/assets/tenpay-seq.QQ47ihE9.png",g=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"jyb/cashier.md","filePath":"jyb/cashier.md","lastUpdated":1713229384000}'),l={name:"jyb/cashier.md"},p=t('<h3 id="支付流程" tabindex="-1">支付流程 <a class="header-anchor" href="#支付流程" aria-label="Permalink to &quot;支付流程&quot;">​</a></h3><blockquote><p>应用发起支付，可以直接调用API,也可以将支付单传给收银台完成支付。</p></blockquote><p><strong>流程1</strong>：通过收银台发起支付</p><ol><li>APP生成业务订单</li><li>APP将业务订单参数传给收银台</li><li>收银台上发起支付</li></ol><p><strong>流程2</strong>：直接调用接口发起支付</p><h3 id="业务逻辑" tabindex="-1">业务逻辑 <a class="header-anchor" href="#业务逻辑" aria-label="Permalink to &quot;业务逻辑&quot;">​</a></h3><blockquote><p>检测浏览器环境，获取传参，检查传参，自动发起预支付请求</p></blockquote><h4 id="接收参数" tabindex="-1">接收参数 <a class="header-anchor" href="#接收参数" aria-label="Permalink to &quot;接收参数&quot;">​</a></h4><table><thead><tr><th>参数名称</th><th>参数说明</th><th>必填</th></tr></thead><tbody><tr><td>orderNo</td><td>业务订单号</td><td>是</td></tr><tr><td>orderName</td><td>业务订单描述</td><td>是</td></tr><tr><td>payAmount</td><td>支付额度，单位:元</td><td>是</td></tr><tr><td>appId</td><td>发起应用的appId，如果不填，收银台会根据支付环境从后端获取默认值</td><td>否</td></tr><tr><td>openId</td><td>用户openId，如果不填，将从后端获取</td><td>否</td></tr><tr><td>attach</td><td>附件</td><td>否</td></tr></tbody></table><p>应用传递参数给收银台 <code>https://pay.rscode.cn/cashier/index.html#/order/base?appid=xxorderNo=xx&amp;orderName=xxx&amp;payAmount=1&amp;attach=x</code></p><p><img src="'+n+`" alt="image-20230307150926019"></p><p>三种扫码环境：</p><p><strong>支付宝扫码</strong></p><p>调用支付宝预支付信息API，保存至<code>formHtml</code></p><p>动态写入html代码，发起支付请求</p><p><strong>微信扫码</strong></p><p>检测到微信环境后，检测是否包含openid参数，如果没有获取openId</p><ol><li>跳转至<code>https://open.weixin.qq.com/connect/qrconnect?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=snsapi_base&amp;state=STATE#wechat_redirect </code>获取扫码者openId,调用微信支付的预支付信息API,发起支付请求</li></ol><p>设置域名 公众号设置与开发-公众号设置-功能设置 js接口安全域名</p><p>Oath2.0网页授权</p><p><strong>手机浏览器扫码</strong></p><p>当前做法时，提示用户扫码方式不正确</p><p>此时己脱离第三方的支付环境，根据选择的支付方式，唤起第三方环境，重新打开网页</p><p>唤起微信</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weixin://&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a.href</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;weixin://&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="收银台" tabindex="-1">收银台 <a class="header-anchor" href="#收银台" aria-label="Permalink to &quot;收银台&quot;">​</a></h3><p>项目<code>Rswl.Payment.Web</code></p><h3 id="直接调用api" tabindex="-1">直接调用API <a class="header-anchor" href="#直接调用api" aria-label="Permalink to &quot;直接调用API&quot;">​</a></h3><h4 id="微信支付接口" tabindex="-1">微信支付接口 <a class="header-anchor" href="#微信支付接口" aria-label="Permalink to &quot;微信支付接口&quot;">​</a></h4><h5 id="_1-jsapi预支付接口" tabindex="-1">1.jsapi预支付接口 <a class="header-anchor" href="#_1-jsapi预支付接口" aria-label="Permalink to &quot;1.jsapi预支付接口&quot;">​</a></h5><p>post <code>api/tenpay/jsapi</code></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  orderNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  orderName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  totalAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  payAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  openId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  quantity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  goodTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  attach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>响应</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">status_code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:{</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  appId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  timeStamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  nonceStr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  signType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;RSA&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  paySign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="_2-native预支付接口" tabindex="-1">2.native预支付接口 <a class="header-anchor" href="#_2-native预支付接口" aria-label="Permalink to &quot;2.native预支付接口&quot;">​</a></h5><p>post <code>api/tenpay/native</code><br> request</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  orderNo:&#39;&#39;,</span></span>
<span class="line"><span>  orderName:&#39;&#39;,</span></span>
<span class="line"><span>  totalAmount:0,</span></span>
<span class="line"><span>  payAmount:0,</span></span>
<span class="line"><span>  openId:&#39;&#39;,</span></span>
<span class="line"><span>  quantity:1,</span></span>
<span class="line"><span>  goodsTag:&#39;&#39;,</span></span>
<span class="line"><span>  attach:&#39;&#39;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>响应</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  code_url:&#39;&#39; </span></span>
<span class="line"><span>}</span></span></code></pre></div><h5 id="查询交易接口" tabindex="-1">查询交易接口 <a class="header-anchor" href="#查询交易接口" aria-label="Permalink to &quot;查询交易接口&quot;">​</a></h5><p>get <code>tenpay/trade/query?orderNo=&amp;tradeNo=</code></p><h5 id="支付回调" tabindex="-1">支付回调 <a class="header-anchor" href="#支付回调" aria-label="Permalink to &quot;支付回调&quot;">​</a></h5><p>接口 post <code>tenpay/notify/{mchid}</code></p><h4 id="支付宝接口" tabindex="-1">支付宝接口 <a class="header-anchor" href="#支付宝接口" aria-label="Permalink to &quot;支付宝接口&quot;">​</a></h4><h5 id="pc网站支付接口" tabindex="-1">pc网站支付接口 <a class="header-anchor" href="#pc网站支付接口" aria-label="Permalink to &quot;pc网站支付接口&quot;">​</a></h5><p>get <code>alipay/pagepay</code><br> orderNo 订单号<br> orderName 商品描述<br> payAmount 支付额度<br> attach 订单附加信息<br> returnUrl 同步回调地址<br> 结果 跳转至支付收款台</p><h5 id="jsapi支付接口" tabindex="-1">jsapi支付接口 <a class="header-anchor" href="#jsapi支付接口" aria-label="Permalink to &quot;jsapi支付接口&quot;">​</a></h5><p>post <code>api/alipay/jsapi</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  orderNo:&#39;&#39;,</span></span>
<span class="line"><span>  orderName:&#39;&#39;,</span></span>
<span class="line"><span>  description:&#39;&#39;</span></span>
<span class="line"><span>  totalAmount:0,</span></span>
<span class="line"><span>  payAmount:0,</span></span>
<span class="line"><span>  openId:&#39;&#39;,</span></span>
<span class="line"><span>  quantity:1,</span></span>
<span class="line"><span>  goodsTag:&#39;&#39;,</span></span>
<span class="line"><span>  attach:&#39;&#39;，</span></span>
<span class="line"><span>  quit_url:&#39;&#39; //支付中途退出返回商户网站地址</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>响应<br> 可以自动提交表单的字符串, js可添加到body执行 <code>document.body.appendChild(content);</code></p><h5 id="交易查询接口" tabindex="-1">交易查询接口 <a class="header-anchor" href="#交易查询接口" aria-label="Permalink to &quot;交易查询接口&quot;">​</a></h5><p>get <code>alipay/trade/query?orderNo=&amp;tradeNo=</code></p><p>响应 交易结果</p><h5 id="pc端支付回调接口" tabindex="-1">PC端支付回调接口 <a class="header-anchor" href="#pc端支付回调接口" aria-label="Permalink to &quot;PC端支付回调接口&quot;">​</a></h5><p>post <code>alipay/notify/pagepay</code></p><h4 id="第三方支付文档" tabindex="-1">第三方支付文档 <a class="header-anchor" href="#第三方支付文档" aria-label="Permalink to &quot;第三方支付文档&quot;">​</a></h4><h5 id="支付jsapi相关文档" tabindex="-1">支付jsapi相关文档 <a class="header-anchor" href="#支付jsapi相关文档" aria-label="Permalink to &quot;支付jsapi相关文档&quot;">​</a></h5><p><a href="https://opendocs.alipay.com/open/common/105591" target="_blank" rel="noreferrer">支付宝jsapi</a><br><a href="https://opendocs.alipay.com/open/54/106682" target="_blank" rel="noreferrer">手机网站支付demo</a><br><a href="https://opendocs.alipay.com/apis/api_1/alipay.trade.wap.pay#%E5%93%8D%E5%BA%94%E5%8F%82%E6%95%B0" target="_blank" rel="noreferrer">手机网站支付接口</a></p><p><a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_7&amp;index=6" target="_blank" rel="noreferrer">微信支付jsapi</a></p><p><strong>微信H5支付开通流程</strong></p><p>开通H5支付，必须先开通微信商户： 入驻成为商户：在线提交营业执照、身份证、银行账户等基本信息，快速提交申请；</p><p>登录【商户平台】，在【产品中心-&gt;产品大全-&gt;我的产品-&gt;H5支付】可以查看H5支付的开通状态。</p><p>点击申请开通页面会来到微信支付H5支付的申请开通界面。 1,支付域名：填写顶级域名（该域名要经过ICP备案）</p><p>2,售卖产品/使用场景：此处需要填写一项需要开通微信支付H5支付企业或者个体户的营业范围。</p><p>3,产品对应网站域名：此处填写支付域名下的网页链接，网页的内容应该为售卖产品的商城内容。</p><p>4,在最后的补充材料中则是提交一份域名证书和<a href="https://kf.qq.com/faq/180315EZjIfe180315JFFVVr.html" target="_blank" rel="noreferrer">域名授权书</a>。</p><p><a href="https://help.aliyun.com/document_detail/117404.html" target="_blank" rel="noreferrer">阿里云</a></p><p>登录-控制台-域名-管理，左侧 域名证书下载</p>`,68),e=[p];function h(k,r,d,o,c,E){return i(),a("div",null,e)}const u=s(l,[["render",h]]);export{g as __pageData,u as default};
